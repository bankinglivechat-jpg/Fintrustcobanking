<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fintrustco | my banking Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* (Keep all existing styles exactly as in the original) */
        :root {
            --primary: #0f172a;
            --primary-light: #1e293b;
            --accent: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body {
            background: #111;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        #app-container {
            width: 100%;
            height: 100vh;
            background: var(--bg);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 550px) {
            body {
                align-items: center;
                background-image: url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=2070&auto=format&fit=crop');
                background-size: cover;
                background-position: center;
            }
            #app-container {
                max-width: 480px;
                height: 90vh;
                max-height: 950px;
                border-radius: 30px;
                box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            }
        }

        /* UTILITIES */
        .hidden { display: none !important; }
        .btn { padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px; justify-content: center;}
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: #e2e8f0; color: var(--primary); }
        .btn-outline { border: 2px solid white; background: transparent; color: white; }
        input:placeholder-shown { font-style: italic; }
        
        #sync-status {
            position: absolute; bottom: 15px; right: 15px; 
            font-size: 10px; color: #fff; background: rgba(0,0,0,0.5); 
            padding: 4px 8px; border-radius: 20px; z-index: 1000; pointer-events: none;
        }

        /* --- CUSTOM LANGUAGE SELECTOR --- */
        .language-selector {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }
        .lang-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            color: white;
            padding: 5px 12px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
        }
        .lang-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        .lang-dropdown {
            display: none;
            position: absolute;
            top: 35px;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            min-width: 150px;
        }
        .lang-dropdown a {
            display: block;
            padding: 8px 15px;
            color: var(--primary);
            text-decoration: none;
            font-size: 13px;
            border-bottom: 1px solid #f1f5f9;
            transition: 0.2s;
        }
        .lang-dropdown a:hover {
            background: #f1f5f9;
        }
        .language-selector:hover .lang-dropdown {
            display: block;
        }

        /* Profile photo edit icon */
        .avatar-wrapper {
            position: relative;
            display: inline-block;
        }
        .avatar-edit-icon {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            border: 2px solid white;
            cursor: pointer;
        }

        /* --- LANDING & INFO PAGES --- */
        #landing-view, #privacy-view, #terms-view, #support-view {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 9000;
            background: #fff; color: var(--text-main); overflow-y: auto; display: flex; flex-direction: column;
        }
        
        .landing-hero {
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.9)), url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
            color: white; padding-bottom: 60px;
        }

        .landing-nav {
            padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;
            background: transparent; position: relative; z-index: 100;
        }
        .landing-nav.sticky { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(5px); position: sticky; top: 0; }

        .landing-logo { font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 10px; color: white; }
        
        .nav-menu-overlay {
            position: absolute; top: 0; right: 0; width: 75%; height: 100vh; background: white; z-index: 200;
            transform: translateX(100%); transition: 0.3s; padding: 25px; color: var(--primary);
            box-shadow: -10px 0 30px rgba(0,0,0,0.5); display: flex; flex-direction: column;
        }
        .nav-menu-overlay.active { transform: translateX(0); }
        .menu-link { display: block; padding: 15px 0; border-bottom: 1px solid #f1f5f9; text-decoration: none; color: var(--primary); font-weight: 600; font-size: 16px;}
        
        .hero-section { padding: 40px 25px; }
        .hero-headline { font-size: 42px; font-weight: 800; line-height: 1.1; margin-bottom: 20px; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .hero-sub { color: #cbd5e1; font-size: 16px; margin-bottom: 30px; line-height: 1.6; }
        .hero-btns { display: flex; flex-direction: column; gap: 15px; }

        /* Content Sections */
        .section-padding { padding: 50px 25px; }
        .bg-light { background: #f8fafc; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-box { background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .stat-num { font-size: 28px; font-weight: 800; color: var(--accent); display: block; }
        .stat-label { font-size: 12px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }

        .feature-item { display: flex; gap: 15px; margin-bottom: 30px; }
        .feature-icon { width: 50px; height: 50px; border-radius: 12px; background: #eff6ff; color: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;}

        /* Legal & Support Pages */
        .page-header { background: var(--primary); color: white; padding: 80px 25px 30px 25px; }
        .text-content { padding: 30px 25px; line-height: 1.8; color: #334155; font-size: 14px; }
        .text-content h3 { color: var(--primary); margin: 25px 0 10px 0; font-size: 18px; }
        .text-content ul { padding-left: 20px; margin-bottom: 15px; }
        .back-fab { position: fixed; bottom: 30px; right: 25px; width: 50px; height: 50px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4); cursor: pointer; z-index: 9999; }

        .landing-footer { background: #020617; padding: 40px 25px 80px 25px; margin-top: auto; color: #94a3b8; }
        .footer-link { color: #64748b; font-size: 13px; text-decoration: none; margin-right: 15px; display: inline-block; margin-bottom: 10px; transition: 0.2s; }
        .footer-link:hover { color: white; }

        /* --- LOGIN & APP --- */
        #login-view {
            display: flex; justify-content: center; align-items: center;
            width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 9100;
            background: #f8fafc;
        }
        .login-box {
            position: relative; width: 85%; padding: 40px 30px;
            background: white; border-radius: 24px;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1); text-align: center;
            border: 1px solid var(--border);
        }
        .login-input { width: 100%; padding: 16px; margin-bottom: 20px; border: 1.5px solid var(--border); border-radius: 10px; font-size: 15px; outline: none; transition: 0.2s; background: #f8fafc; }
        .login-input:focus { border-color: var(--accent); background: #fff; }

        /* DASHBOARD STYLES (Existing) */
        #dashboard-view { display: flex; height: 100%; position: relative; overflow: hidden; flex: 1; z-index: 9000;}
        
        .sidebar {
            width: var(--sidebar-width); background: var(--primary); color: white; height: 100%; 
            display: flex; flex-direction: column; padding: 30px 20px; transition: 0.3s; z-index: 500;
            position: absolute; left: 0; top: 0; transform: translateX(-100%);
        }
        .sidebar.active { transform: translateX(0); box-shadow: 10px 0 30px rgba(0,0,0,0.2); }
        
        .brand { font-size: 24px; font-weight: 800; margin-bottom: 40px; display: flex; align-items: center; justify-content: space-between; color: #fff; }
        .nav-group-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: #475569; margin: 20px 0 10px 10px; font-weight: 700; }
        .nav-link {
            padding: 12px 15px; color: #94a3b8; text-decoration: none; display: flex; align-items: center; gap: 12px;
            border-radius: 10px; margin-bottom: 4px; transition: 0.2s; cursor: pointer; font-size: 14px; font-weight: 500;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.05); color: white; }
        .nav-link.active { background: var(--accent); color: white; }
        
        .main-content { flex: 1; overflow-y: auto; padding: 30px 25px; width: 100%; margin-left: 0; padding-bottom: 80px;}
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px; }
        .toggle-btn { font-size: 20px; color: var(--text-main); cursor: pointer; margin-right: 15px; display: block; }
        .welcome-text { font-size: 12px; color: var(--text-muted); font-weight: 600; display: block; margin-bottom: 2px;}
        .user-avatar-container {
            width: 45px; height: 45px; border-radius: 50%; 
            background: #e2e8f0; cursor: pointer; overflow: hidden;
            position: relative; border: 2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .user-avatar-container img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-edit-icon {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            border: 2px solid white;
            cursor: pointer;
            pointer-events: auto;
        }
        .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 30px; }
        .balance-card { padding: 25px; border-radius: 20px; color: white; position: relative; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .card-1 { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
        .card-2 { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .card-3 { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .bal-amount { font-size: 28px; font-weight: 700; margin: 8px 0; }
        .rates-container { display: flex; gap: 20px; background: white; padding: 15px 20px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 30px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .rate-item { display: flex; align-items: center; gap: 10px; white-space: nowrap; font-size: 13px; font-weight: 600; }
        .rate-up { color: var(--success); }
        .rate-down { color: var(--danger); }
        .section-view { display: none; animation: fadeIn 0.3s ease; }
        .section-view.active { display: block; }
        .content-card { background: white; padding: 20px; border-radius: 20px; border: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; white-space: nowrap; }
        th { text-align: left; padding: 12px; color: var(--text-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1.5px solid var(--border); }
        td { padding: 16px 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .icon-box { width: 35px; height: 35px; border-radius: 8px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .modal-overlay { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 10000; }
        .modal-box { background: white; padding: 30px; border-radius: 24px; width: 85%; text-align: center; max-height: 90%; overflow-y: auto;}
        .profile-photo-modal .modal-box {
            max-width: 300px;
            padding: 20px;
        }
        .profile-photo-modal img {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="app-container">
    
    <div id="sync-status">Local Mode</div>
    <input type="file" id="profile-upload" accept="image/*" class="hidden" onchange="handleProfileUpload(this)">

    <div id="landing-view">
        <div class="landing-hero">
            <nav class="landing-nav sticky">
                <div class="landing-logo">
                    <i class="fas fa-shield-halved" style="color: var(--accent);"></i> Fintrustco
                </div>
                <div style="display:flex; gap:15px; align-items: center;">
                    <!-- Custom Language Selector (replaces old widget) -->
                    <div class="language-selector">
                        <button class="lang-btn"><i class="fas fa-globe"></i> <span id="current-lang-label">English</span> <i class="fas fa-chevron-down"></i></button>
                        <div class="lang-dropdown">
                            <a href="#" data-lang="en">üá¨üáß English</a>
                            <a href="#" data-lang="es">üá™üá∏ Espa√±ol</a>
                            <a href="#" data-lang="fr">üá´üá∑ Fran√ßais</a>
                            <a href="#" data-lang="de">üá©üá™ Deutsch</a>
                            <a href="#" data-lang="it">üáÆüáπ Italiano</a>
                            <a href="#" data-lang="pt">üáµüáπ Portugu√™s</a>
                            <a href="#" data-lang="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</a>
                            <a href="#" data-lang="zh-CN">üá®üá≥ ‰∏≠Êñá</a>
                            <a href="#" data-lang="ja">üáØüáµ Êó•Êú¨Ë™û</a>
                            <a href="#" data-lang="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
                            <a href="#" data-lang="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</a>
                        </div>
                    </div>
                    <i class="fas fa-search" style="font-size: 16px; color:white; cursor:pointer;" onclick="alert('Search functionality coming soon.')"></i>
                    <i class="fas fa-bars" style="font-size: 22px; cursor: pointer; color:white;" onclick="toggleLandingMenu()"></i>
                </div>
            </nav>

            <header class="hero-section">
                <h1 class="hero-headline">Secure.<br>Smart.<br>Modern Banking.</h1>
                <p class="hero-sub">Experience 11 years of excellence in wealth management. Global transfers, crypto assets, and premium insights at your fingertips.</p>
                <div class="hero-btns">
                    <button class="btn btn-primary" onclick="handleOpenAccount()">Open Account</button>
                    <button class="btn btn-outline" onclick="goToLogin()">Member Login</button>
                </div>
            </header>
        </div>

        <section class="section-padding bg-light">
            <h2 style="font-size: 22px; font-weight: 800; text-align: center; margin-bottom: 10px;">Trusted Globally</h2>
            <p style="text-align: center; color: var(--text-muted); font-size: 14px;">Delivering financial security since 2015.</p>
            
            <div class="stat-grid">
                <div class="stat-box">
                    <span class="stat-num">11+</span>
                    <span class="stat-label">Years Experience</span>
                </div>
                <div class="stat-box">
                    <span class="stat-num">$5B+</span>
                    <span class="stat-label">Assets Secured</span>
                </div>
                <div class="stat-box">
                    <span class="stat-num">140</span>
                    <span class="stat-label">Countries Supported</span>
                </div>
                <div class="stat-box">
                    <span class="stat-num">24/7</span>
                    <span class="stat-label">Live Support</span>
                </div>
            </div>
        </section>

        <section class="section-padding" style="background: white;">
            <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 30px;">Why choose Fintrustco?</h3>
            
            <div class="feature-item">
                <div class="feature-icon"><i class="fas fa-lock"></i></div>
                <div>
                    <h4 style="margin-bottom: 5px;">Bank-Grade Security</h4>
                    <p style="font-size: 13px; color: var(--text-muted); line-height: 1.5;">We utilize 256-bit AES encryption to ensure your data and funds are never compromised.</p>
                </div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon"><i class="fas fa-globe"></i></div>
                <div>
                    <h4 style="margin-bottom: 5px;">Borderless Banking</h4>
                    <p style="font-size: 13px; color: var(--text-muted); line-height: 1.5;">Send wire transfers to over 140 countries instantly via our SWIFT/SEPA integration.</p>
                </div>
            </div>

            <div class="feature-item">
                <div class="feature-icon"><i class="fas fa-coins"></i></div>
                <div>
                    <h4 style="margin-bottom: 5px;">Hybrid Assets</h4>
                    <p style="font-size: 13px; color: var(--text-muted); line-height: 1.5;">Manage Traditional Fiat currencies and Crypto Assets in one unified dashboard.</p>
                </div>
            </div>
        </section>

        <footer class="landing-footer">
            <h4 style="margin-bottom: 15px; color: white;">About Fintrustco</h4>
            <p style="color: #64748b; font-size: 13px; margin-bottom: 25px; line-height: 1.6;">
                We are a digital-first financial institution dedicated to providing high-net-worth individuals with seamless banking solutions. Regulated by the Global Banking Authority.
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 5px; margin-bottom: 30px;">
                <a href="#" class="footer-link" onclick="openPage('privacy-view')">Privacy Policy</a>
                <a href="#" class="footer-link" onclick="openPage('terms-view')">Terms & Conditions</a>
                <a href="#" class="footer-link" onclick="openContact()">Contact Us</a>
                <a href="#" class="footer-link" onclick="openPage('support-view')">Help & Support</a>
            </div>

            <div style="color: #475569; font-size: 11px; border-top: 1px solid #1e293b; padding-top: 20px;">
                &copy; 2026 Fintrustco Banking Group. All rights reserved.
            </div>
        </footer>

        <div id="landing-menu" class="nav-menu-overlay">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h3 style="font-size: 22px;">Menu</h3>
                <i class="fas fa-times" style="font-size: 24px; cursor: pointer;" onclick="toggleLandingMenu()"></i>
            </div>
            
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); scrollToTop()">Home</a>
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); handleOpenAccount()">Personal Banking</a>
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); goToLogin()">Loans & Credit</a>
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); handleOpenAccount()">Private Wealth</a>
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); openPage('support-view')">Support Center</a>
            <a href="#" class="menu-link" onclick="toggleLandingMenu(); openContact()">Contact Us</a>
            
            <div style="margin-top: auto;">
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="toggleLandingMenu(); goToLogin();">Log In</button>
            </div>
        </div>
    </div>

    <div id="privacy-view" class="hidden">
        <div class="page-header">
            <h1>Privacy Policy</h1>
            <p style="opacity: 0.8;">Last updated: January 2026</p>
        </div>
        <div class="text-content">
            <p>At Fintrustco, we prioritize the privacy and security of your financial data. This policy outlines how we collect, use, and protect your information.</p>
            <h3>1. Information Collection</h3>
            <p>We collect personal identification information (Name, Email, Phone number, Government ID) and financial data (Transaction history, Account balances) to provide our services.</p>
            <h3>2. Data Usage</h3>
            <ul>
                <li>To process transactions and manage your account.</li>
                <li>To improve customer service and support needs.</li>
                <li>To send periodic emails regarding your order or other products and services.</li>
            </ul>
            <h3>3. Data Protection</h3>
            <p>We implement a variety of security measures including 256-bit encryption, two-factor authentication, and biometric verification to maintain the safety of your personal information.</p>
            <h3>4. Third Party Disclosure</h3>
            <p>We do not sell, trade, or otherwise transfer to outside parties your Personally Identifiable Information unless we provide users with advance notice or is required by law.</p>
        </div>
        <div class="back-fab" onclick="closePage('privacy-view')"><i class="fas fa-arrow-left"></i></div>
    </div>

    <div id="terms-view" class="hidden">
        <div class="page-header">
            <h1>Terms of Service</h1>
            <p style="opacity: 0.8;">Contract of Agreement</p>
        </div>
        <div class="text-content">
            <h3>1. Introduction</h3>
            <p>By accessing this website and using our banking services, you accept these terms and conditions in full. Do not continue to use Fintrustco's website if you do not accept all of the terms and conditions stated on this page.</p>
            <h3>2. Account Usage</h3>
            <p>You agree to use your account only for lawful purposes. You are responsible for maintaining the confidentiality of your login credentials and PINs.</p>
            <h3>3. Limitations of Liability</h3>
            <p>Fintrustco will not be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on Fintrustco's website.</p>
            <h3>4. Termination</h3>
            <p>We may terminate or suspend access to our Service immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>
        </div>
        <div class="back-fab" onclick="closePage('terms-view')"><i class="fas fa-arrow-left"></i></div>
    </div>

    <div id="support-view" class="hidden">
        <div class="page-header">
            <h1>Support Center</h1>
            <p style="opacity: 0.8;">We are here to help.</p>
        </div>
        <div class="text-content">
            <div style="background: #eff6ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="color:var(--accent); margin-bottom: 10px;">Need immediate help?</h4>
                <button class="btn btn-primary" style="width: 100%;" onclick="openContact()">Chat with Agent</button>
            </div>
            <h3>Common Issues</h3>
            <div style="margin-bottom: 15px;">
                <strong><i class="fas fa-question-circle"></i> How do I reset my PIN?</strong>
                <p style="margin-top: 5px; color: var(--text-muted);">Navigate to Settings > Security within the app dashboard to update your 6-digit PIN.</p>
            </div>
            <div style="margin-bottom: 15px;">
                <strong><i class="fas fa-question-circle"></i> Wire Transfer Delays</strong>
                <p style="margin-top: 5px; color: var(--text-muted);">International SWIFT transfers typically take 1-3 business days. If it has been longer, please contact support with your Reference ID.</p>
            </div>
            <div style="margin-bottom: 15px;">
                <strong><i class="fas fa-question-circle"></i> Lost or Stolen Card</strong>
                <p style="margin-top: 5px; color: var(--text-muted);">Log in immediately and go to "Card Manager" to freeze your card. Then contact support for a replacement.</p>
            </div>
        </div>
        <div class="back-fab" onclick="closePage('support-view')"><i class="fas fa-arrow-left"></i></div>
    </div>

    <div id="login-view" class="hidden">
        <div class="login-box">
            <div style="position: absolute; top: 15px; left: 15px; cursor: pointer;" onclick="backToLanding()">
                <i class="fas fa-arrow-left" style="font-size: 18px; color: var(--text-main);"></i>
            </div>
            <div style="margin-bottom: 30px;">
                <i class="fas fa-shield-halved" style="color: var(--accent); font-size: 40px;"></i>
            </div>
            <h2 style="margin-bottom: 10px; font-weight: 800;">Welcome Back</h2>
            <p style="color: var(--text-muted); margin-bottom: 30px; font-size: 14px;">Access your private portfolio</p>
            
            <form id="loginForm">
                <input type="text" id="username" class="login-input" placeholder="Login ID" required>
                <input type="password" id="password" class="login-input" placeholder="Password" required>
                
                <div style="display: flex; align-items: center; margin-bottom: 20px; text-align: left;">
                    <input type="checkbox" id="rememberMe" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                    <label for="rememberMe" style="font-size: 14px; color: var(--text-muted); cursor: pointer;">Remember me</label>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width:100%; padding: 16px; font-size: 16px;">Secure Login</button>
            </form>
            <div style="margin-top: 20px; font-size: 13px; color: var(--text-muted);">
                <i class="fas fa-lock"></i> 256-bit End-to-End Encryption
            </div>
        </div>
    </div>

    <div id="dashboard-view" class="hidden">
        
        <nav class="sidebar" id="sidebar">
            <div class="brand">
                <span><i class="fas fa-shield-halved"></i> Fintrustco</span>
                <i class="fas fa-times" style="cursor: pointer; font-size: 18px;" onclick="toggleSidebar()"></i>
            </div>
            
            <div class="nav-group-label">Core Banking</div>
            <a class="nav-link active" onclick="navTo('home', this)"><i class="fas fa-chart-pie"></i> Wealth Overview</a>
            <a class="nav-link" onclick="navTo('transfer', this)"><i class="fas fa-arrow-right-arrow-left"></i> Wire Transfer</a>
            <a class="nav-link" onclick="navTo('payments', this)"><i class="fas fa-receipt"></i> Bill Payments</a>
            <a class="nav-link" onclick="navTo('cards', this)"><i class="fas fa-credit-card"></i> Card Manager</a>
            
            <div class="nav-group-label">Investments</div>
            <a class="nav-link" onclick="navTo('stocks', this)"><i class="fas fa-arrow-trend-up"></i> Stock Portfolio</a>
            <a class="nav-link" onclick="navTo('crypto', this)"><i class="fas fa-coins"></i> Crypto Assets</a>
            
            <div class="nav-group-label">Preferences</div>
            <a class="nav-link" onclick="navTo('settings', this)"><i class="fas fa-user-gear"></i> Security Settings</a>
            <a class="nav-link" onclick="navTo('concierge', this)"><i class="fas fa-headset"></i> Private Concierge</a>
            
            <div style="margin-top: auto;">
                <a class="nav-link" onclick="logout()" style="color: var(--danger);"><i class="fas fa-power-off"></i> Terminate Session</a>
            </div>
        </nav>

        <main class="main-content" id="main-content">
            <header class="header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
                    <div>
                        <span class="welcome-text">Welcome back,</span>
                        <h2 id="page-title" style="font-weight: 800; font-size: 20px; margin:0;">User</h2>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px;">
                    <!-- Avatar with view (click) and edit (pencil) -->
                    <div class="avatar-wrapper">
                        <div class="user-avatar-container" onclick="viewProfilePhoto()">
                            <img id="user-avatar-img" src="https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff" alt="User">
                        </div>
                        <div class="avatar-edit-icon" onclick="document.getElementById('profile-upload').click()">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    </div>
                </div>
            </header>

            <div class="rates-container">
                <div class="rate-item"><i class="fab fa-bitcoin" style="color:#f59e0b"></i> BTC <span class="rate-up">$42,350 (+1.2%)</span></div>
                <div class="rate-item"><i class="fas fa-euro-sign" style="color:#3b82f6"></i> EUR <span class="rate-down">1.089 (-0.05%)</span></div>
                <div class="rate-item"><i class="fas fa-gem" style="color:#94a3b8"></i> GOLD <span class="rate-up">$2,024 (+0.4%)</span></div>
            </div>

            <div id="view-home" class="section-view active">
                <div class="dashboard-grid">
                    <div class="balance-card card-1">
                        <div style="font-size: 12px; opacity: 0.8; font-weight: 600;">CHECKING ACCOUNT</div>
                        <div class="bal-amount" id="bal-checking">$0.00</div>
                        <div style="font-size: 11px; font-family: monospace;">ACC: **** 8842</div>
                    </div>
                    <div class="balance-card card-2">
                        <div style="font-size: 12px; opacity: 0.8; font-weight: 600;">SAVINGS RESERVE</div>
                        <div class="bal-amount" id="bal-savings">$0.00</div>
                        <div style="font-size: 11px;">APY: 4.85% (Accruing Daily)</div>
                    </div>
                    <div class="balance-card card-3">
                        <div style="font-size: 12px; opacity: 0.8; font-weight: 600;">TOTAL LIABILITIES</div>
                        <div class="bal-amount" id="bal-loan">$0.00</div>
                        <div style="font-size: 11px;">MORTGAGE & PERSONAL LOAN</div>
                    </div>
                </div>

                <div class="content-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                        <h3 style="font-size: 18px;">Transaction Ledger</h3>
                        <button class="btn btn-primary" style="background: var(--primary); font-size: 12px;" onclick="openEmailModal()">
                            <i class="fas fa-envelope"></i> Email PDF
                        </button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr><th>Entity</th><th>Method</th><th>Amount</th><th>Action</th></tr>
                            </thead>
                            <tbody id="tx-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-transfer" class="section-view">
                <div class="content-card">
                    <h3 style="margin-bottom: 10px;">Global Wire Transfer</h3>
                    <p style="color:var(--text-muted); margin-bottom:30px; font-size: 14px;">Processed via SWIFT/SEPA network.</p>
                    <div class="transfer-form-grid">
                        <div class="full-width"><label>Recipient‚Äôs Full Name</label><input type="text" id="rec-name" class="login-input"></div>
                        <div><label>Account / IBAN</label><input type="text" id="rec-acc" class="login-input"></div>
                        <div><label>Bank Name</label><input type="text" id="rec-bank" class="login-input"></div>
                        <div><label>BIC / SWIFT</label><input type="text" id="rec-swift" class="login-input"></div>
                        <div><label>Routing No</label><input type="text" id="rec-routing" class="login-input"></div>
                        <div><label>Amount ($)</label><input type="number" id="transfer-amount" class="login-input"></div>
                        <div><label>Reference</label><input type="text" id="rec-ref" class="login-input"></div>
                        <div class="full-width" style="margin-top: 10px;">
                            <button class="btn btn-primary" style="width:100%; padding: 16px;" onclick="initiateTransfer()">
                                <i class="fas fa-paper-plane"></i> Initialize Global Wire
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-payments" class="section-view">
                <div class="content-card">
                    <h3>Pending Invoices</h3>
                    <p style="color:var(--text-muted); margin-bottom: 20px;">No pending bills found.</p>
                    <button class="btn btn-primary" style="width: 100%;" onclick="alert('Biller directory updated.')">Add New Biller</button>
                </div>
            </div>

            <div id="view-cards" class="section-view">
                <div class="content-card">
                    <div style="background: linear-gradient(135deg, #000, #333); padding: 25px; border-radius: 15px; color: white; margin-bottom: 20px; box-shadow: 0 10px 20px -5px rgba(0,0,0,0.3);">
                        <div style="display:flex; justify-content: space-between; margin-bottom: 30px;">
                            <i class="fas fa-wifi" style="transform: rotate(90deg);"></i>
                            <span style="font-style: italic; font-weight: 800; font-size: 14px;">VISA INFINITE</span>
                        </div>
                        <div style="font-size: 20px; letter-spacing: 3px; margin-bottom: 20px;">**** **** **** 8842</div>
                        <div style="display:flex; justify-content: space-between; font-size: 11px;">
                            <span class="card-name-display">USER</span>
                            <span>05/30</span>
                        </div>
                    </div>
                    <button class="btn btn-danger" style="width: 100%; padding: 16px;" onclick="askPin(() => alert('Card Frozen'))">Freeze Card</button>
                </div>
            </div>

            <div id="view-stocks" class="section-view">
                <div class="content-card">
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 12px; color: var(--text-muted);">Total Equity Value</div>
                        <div style="font-weight: 700; font-size: 24px;">$484,112.90</div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead><tr><th>Ticker</th><th>Shares</th><th>Gain/Loss</th></tr></thead>
                            <tbody>
                                <tr><td><strong>MSFT</strong></td><td>650</td><td class="rate-up">+$22.4K</td></tr>
                                <tr><td><strong>AMZN</strong></td><td>200</td><td class="rate-down">-$1.8K</td></tr>
                                <tr><td><strong>GOOGL</strong></td><td>350</td><td class="rate-up">+$15.2K</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-crypto" class="section-view">
                <div class="content-card">
                    <h3>Digital Assets</h3>
                    <div style="overflow-x: auto;">
                        <table style="margin-top: 20px;">
                            <thead><tr><th>Asset</th><th>Balance</th><th>USD Value</th></tr></thead>
                            <tbody>
                                <tr><td><i class="fab fa-bitcoin" style="color: #f59e0b;"></i> BTC</td><td>3.85</td><td>$163,052</td></tr>
                                <tr><td><i class="fab fa-ethereum" style="color: #3b82f6;"></i> ETH</td><td>25.00</td><td>$57,500</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-settings" class="section-view">
                <div class="content-card">
                    <h3>Security Preferences</h3>
                    <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border); border-radius: 10px;">
                        <strong>Change PIN</strong>
                        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 15px;">Update your 6-digit transaction PIN.</p>
                        <input type="password" class="login-input" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" style="width: 100%;" onclick="alert('Request sent to admin.')">Update PIN</button>
                    </div>
                </div>
            </div>

            <div id="view-concierge" class="section-view">
                <div class="content-card" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-headset" style="font-size: 50px; color: var(--accent); margin-bottom: 20px;"></i>
                    <h3>Private Concierge</h3>
                    <p style="color: var(--text-muted); margin-bottom: 30px;">Your dedicated wealth manager is <strong>Michael Ross</strong>.</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                         <button class="btn btn-primary" style="width: 100%; padding: 16px;" onclick="openContact()">Chat Live Now</button>
                         <button class="btn" style="border: 1px solid var(--border); width: 100%; padding: 16px;" onclick="alert('Message sent.')">Leave Message</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- PIN Modal -->
    <div class="modal-overlay" id="pin-modal">
        <div class="modal-box">
            <i class="fas fa-lock" style="font-size: 40px; color: var(--accent); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;">Authorization</h3>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">Enter 6-digit PIN to confirm.</p>
            <input type="password" id="pin-entry" class="login-input" maxlength="6" style="text-align: center; font-size: 24px; letter-spacing: 5px;">
            <div style="display:flex; gap:12px; margin-top: 15px;">
                <button class="btn" style="background:#f1f5f9; flex:1; padding: 16px;" onclick="closeModal('pin-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex:1; padding: 16px;" onclick="submitPin()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div class="modal-overlay" id="email-modal">
        <div class="modal-box">
            <i class="fas fa-envelope-open-text" style="font-size: 40px; color: var(--primary); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;">Export Statement</h3>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">Securely send transaction history to:</p>
            <input type="email" id="statement-email" class="login-input" value="user@example.com">
            <div id="email-loader" class="hidden" style="margin-bottom: 15px; color: var(--accent);"><i class="fas fa-spinner fa-spin"></i> Generating 256-bit Encrypted PDF...</div>
            <div style="display:flex; gap:12px; margin-top: 15px;">
                <button class="btn" style="background:#f1f5f9; flex:1; padding: 16px;" onclick="closeModal('email-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex:1; padding: 16px;" onclick="sendEmailAction()">Send Now</button>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div class="modal-overlay" id="receipt-modal">
        <div class="modal-box">
            <i class="fas fa-check-circle" style="font-size: 40px; color: var(--success); margin-bottom: 10px;"></i>
            <h3 style="margin-bottom: 5px;">Transaction Successful</h3>
            <div class="receipt-container" id="receipt-content">
                </div>
            <div style="display:flex; flex-direction: column; gap:12px; margin-top: 15px;">
                <button class="btn btn-primary" style="width:100%; padding: 16px;" onclick="printReceipt()">
                    <i class="fas fa-print"></i> Print Payment Slip
                </button>
                <button class="btn btn-secondary" style="width:100%; padding: 16px;" onclick="closeModal('receipt-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Fail Modal -->
    <div class="modal-overlay" id="fail-modal">
        <div class="modal-box">
            <i class="fas fa-times-circle" style="font-size: 40px; color: var(--danger); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px; color: var(--danger);">Transaction Failed</h3>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
                We could not process this wire transfer due to a security flag on your account.
                <br><br>
                <strong>Code: ERR-909 (Frozen)</strong>
            </p>
            <button class="btn btn-primary" style="width:100%; padding: 16px;" onclick="openContact(); closeModal('fail-modal')">
                Contact Support Immediately
            </button>
            <button class="btn" style="margin-top:10px; width:100%; color: #999;" onclick="closeModal('fail-modal')">Close</button>
        </div>
    </div>

    <!-- Account Loading Modal -->
    <div class="modal-overlay" id="account-loading-modal">
        <div class="modal-box">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 40px; color: var(--accent); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;">Verifying Eligibility</h3>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">Redirecting you to the secure application portal...</p>
        </div>
    </div>

    <!-- Profile Photo View Modal -->
    <div class="modal-overlay profile-photo-modal" id="profile-photo-modal">
        <div class="modal-box">
            <img id="profile-photo-full" src="" alt="Profile Photo">
            <button class="btn btn-primary" style="width:100%;" onclick="closeModal('profile-photo-modal')">Close</button>
        </div>
    </div>

</div> 

<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js-eu1.hs-scripts.com/147876750.js"></script>
<!-- End of HubSpot Embed Code -->

<!-- Firebase Integration Script with Remember Me, Full Name on Card, Translator & Profile View -->
<script>
    // Firebase Config (for fintrustco-1a310)
    const firebaseConfig = {
        apiKey: "AIzaSyC7f33avt1NC9chkyYsik1mRwne42jif6I",
        authDomain: "fintrustco-1a310.firebaseapp.com",
        databaseURL: "https://fintrustco-1a310-default-rtdb.firebaseio.com",
        projectId: "fintrustco-1a310",
        storageBucket: "fintrustco-1a310.firebasestorage.app",
        messagingSenderId: "546467878943",
        appId: "1:546467878943:web:8fd102abe080c2d8281d2a"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;          // holds username
    let userData = null;             // holds user data from DB
    let pendingAction = null;
    let currentReceiptData = null;   // for receipt modal

    // UI Elements
    const syncStatus = document.getElementById('sync-status');
    syncStatus.innerHTML = '<i class="fas fa-cloud"></i> Cloud Active';
    syncStatus.style.background = "var(--success)";

    // ---------- SESSION PERSISTENCE WITH REMEMBER ME ----------
    async function restoreSession() {
        const storedUser = localStorage.getItem('fintrust_user') || sessionStorage.getItem('fintrust_user');
        if (!storedUser) return;

        try {
            const snapshot = await db.ref('users/' + storedUser).once('value');
            const user = snapshot.val();
            if (user) {
                setupUserListener(storedUser);
                document.getElementById('landing-view').classList.add('hidden');
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('dashboard-view').classList.remove('hidden');
                userData = user;
                updateUI();
            } else {
                localStorage.removeItem('fintrust_user');
                sessionStorage.removeItem('fintrust_user');
            }
        } catch (error) {
            console.error('Session restore error', error);
            localStorage.removeItem('fintrust_user');
            sessionStorage.removeItem('fintrust_user');
        }
    }

    function setupUserListener(username) {
        if (currentUser) {
            db.ref('users/' + currentUser).off();
        }
        currentUser = username;
        db.ref('users/' + username).on('value', (snap) => {
            if (snap.exists()) {
                userData = snap.val();
                updateUI();
            } else {
                logout();
            }
        });
    }

    function updateUI() {
        if (!userData) return;
        document.getElementById('page-title').innerText = currentUser;
        
        // Display full name on card (use firstName + lastName if available)
        const fullName = (userData.firstName && userData.lastName) 
            ? `${userData.firstName} ${userData.lastName}` 
            : currentUser;
        document.querySelector('.card-name-display').innerText = fullName.toUpperCase();

        if (userData.profilePic) {
            document.getElementById('user-avatar-img').src = userData.profilePic;
        } else {
            document.getElementById('user-avatar-img').src = `https://ui-avatars.com/api/?name=${fullName}&background=0D8ABC&color=fff`;
        }

        document.getElementById('bal-checking').innerText = '$' + (userData.checking || 0).toLocaleString('en-US', {minimumFractionDigits:2});
        document.getElementById('bal-savings').innerText = '$' + (userData.savings || 0).toLocaleString('en-US', {minimumFractionDigits:2});
        document.getElementById('bal-loan').innerText = '$' + (userData.loan || 0).toLocaleString('en-US', {minimumFractionDigits:2});

        // Transactions
        const tbody = document.getElementById('tx-table-body');
        tbody.innerHTML = '';
        if (userData.transactions && userData.transactions.length) {
            userData.transactions.forEach((tx, index) => {
                const color = tx.amount > 0 ? 'var(--success)' : 'var(--text-main)';
                const sign = tx.amount > 0 ? '+' : '-';
                tbody.innerHTML += `
                    <tr>
                        <td>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div class="icon-box" style="width:30px; height:30px;"><i class="${tx.icon}" style="font-size:12px;"></i></div>
                                <div style="display:flex; flex-direction:column;">
                                    <strong style="font-size:13px;">${tx.entity}</strong>
                                    <span style="font-size:11px; color:var(--text-muted);">${tx.date}</span>
                                </div>
                            </div>
                        </td>
                        <td><span style="font-size:11px; color:var(--text-muted);">Transfer</span></td>
                        <td style="color:${color}; font-weight:700; text-align:right;">${sign}$${Math.abs(tx.amount).toLocaleString()}</td>
                        <td><button onclick="showReceipt(${index})" style="background:none; border:none; color:var(--accent); cursor:pointer;"><i class="fas fa-receipt"></i></button></td>
                    </tr>
                `;
            });
        } else {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No transactions</td></tr>';
        }
    }

    function submitPin() {
        if(document.getElementById('pin-entry').value === userData.pin) {
            closeModal('pin-modal');
            if(pendingAction) pendingAction();
            document.getElementById('pin-entry').value = '';
        } else {
            alert("Incorrect PIN");
            document.getElementById('pin-entry').value = '';
        }
    }

    function initiateTransfer() {
        if (userData.blocked) {
            document.getElementById('fail-modal').style.display = 'flex';
            return;
        }
        const amt = parseFloat(document.getElementById('transfer-amount').value);
        const name = document.getElementById('rec-name').value.trim();
        const acc = document.getElementById('rec-acc').value.trim();
        const bank = document.getElementById('rec-bank').value.trim();
        const swift = document.getElementById('rec-swift').value.trim();
        const routing = document.getElementById('rec-routing').value.trim();
        const ref = document.getElementById('rec-ref').value.trim();
        if (!amt || amt <= 0 || !name || !acc) {
            alert("Please complete all required fields (Amount, Recipient Name, Account).");
            return;
        }
        if (userData.checking < amt) {
            alert("Insufficient funds in checking account.");
            return;
        }
        askPin(() => {
            const newBalance = userData.checking - amt;
            const transaction = {
                entity: name,
                amount: -amt,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                icon: 'fa-paper-plane',
                ref: 'WIRE-' + Math.random().toString(36).substring(2,8).toUpperCase(),
                accNum: acc.slice(-4).padStart(acc.length, '*')
            };
            userData.checking = newBalance;
            if (!userData.transactions) userData.transactions = [];
            userData.transactions.unshift(transaction);
            const updates = {};
            updates['checking'] = newBalance;
            updates['transactions'] = userData.transactions;
            db.ref('users/' + currentUser).update(updates).then(() => {
                currentReceiptData = transaction;
                renderReceiptInModal(transaction);
                document.getElementById('receipt-modal').style.display = 'flex';
                document.getElementById('rec-name').value = '';
                document.getElementById('rec-acc').value = '';
                document.getElementById('rec-bank').value = '';
                document.getElementById('rec-swift').value = '';
                document.getElementById('rec-routing').value = '';
                document.getElementById('rec-ref').value = '';
                document.getElementById('transfer-amount').value = '';
            }).catch(err => {
                alert("Transfer failed: " + err.message);
            });
        });
    }

    // Login Form with Remember Me
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;

        try {
            const snapshot = await db.ref('users/' + username).once('value');
            const user = snapshot.val();
            if (user && user.password === password) {
                if (rememberMe) {
                    localStorage.setItem('fintrust_user', username);
                    sessionStorage.removeItem('fintrust_user');
                } else {
                    sessionStorage.setItem('fintrust_user', username);
                    localStorage.removeItem('fintrust_user');
                }
                setupUserListener(username);
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('dashboard-view').classList.remove('hidden');
                userData = user;
                updateUI();
            } else {
                alert("Invalid username or password");
            }
        } catch (error) {
            console.error(error);
            alert("Login error. Please try again.");
        }
    });

    function logout() { 
        if (currentUser) {
            db.ref('users/' + currentUser).off();
        }
        localStorage.removeItem('fintrust_user');
        sessionStorage.removeItem('fintrust_user');
        location.reload();
    }

    // ---------- CUSTOM TRANSLATOR (Google Translate wrapper) ----------
    function googleTranslateElementInit() {
        // Initialize Google Translate with disabled UI (we use custom dropdown)
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,es,fr,de,it,pt,ru,zh-CN,ja,ar,hi',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false
        }, 'google_translate_element_hidden'); // Hidden element
    }

    // Change language function
    function changeLanguage(lang) {
        let expireDate = new Date();
        expireDate.setDate(expireDate.getDate() + 365);
        document.cookie = `googtrans=/en/${lang}; expires=${expireDate.toUTCString()}; path=/`;
        location.reload();
    }

    // Update current language label in custom dropdown
    function updateCurrentLangLabel() {
        const langCookie = document.cookie.replace(/(?:(?:^|.*;\s*)googtrans\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (langCookie) {
            const lang = langCookie.split('/').pop();
            const map = {
                'en': 'English', 'es': 'Espa√±ol', 'fr': 'Fran√ßais', 'de': 'Deutsch',
                'it': 'Italiano', 'pt': 'Portugu√™s', 'ru': '–†—É—Å—Å–∫–∏–π', 'zh-CN': '‰∏≠Êñá',
                'ja': 'Êó•Êú¨Ë™û', 'ar': 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', 'hi': '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä'
            };
            document.getElementById('current-lang-label').innerText = map[lang] || 'English';
        } else {
            document.getElementById('current-lang-label').innerText = 'English';
        }
    }

    // Attach language selector events
    document.querySelectorAll('.lang-dropdown a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const lang = link.getAttribute('data-lang');
            changeLanguage(lang);
        });
    });

    // ---------- PROFILE PHOTO VIEW ----------
    function viewProfilePhoto() {
        const imgSrc = document.getElementById('user-avatar-img').src;
        document.getElementById('profile-photo-full').src = imgSrc;
        document.getElementById('profile-photo-modal').style.display = 'flex';
    }

    // ---------- OTHER FUNCTIONS (unchanged) ----------
    function toggleLandingMenu() {
        document.getElementById('landing-menu').classList.toggle('active');
    }

    function scrollToTop() {
        document.getElementById('landing-view').scrollTop = 0;
    }

    function goToLogin() {
        document.getElementById('landing-view').classList.add('hidden');
        document.getElementById('privacy-view').classList.add('hidden');
        document.getElementById('terms-view').classList.add('hidden');
        document.getElementById('support-view').classList.add('hidden');
        document.getElementById('login-view').classList.remove('hidden');
    }

    function backToLanding() {
        document.getElementById('login-view').classList.add('hidden');
        document.getElementById('landing-view').classList.remove('hidden');
    }

    function openPage(pageId) {
        document.getElementById('landing-view').classList.add('hidden');
        document.getElementById('login-view').classList.add('hidden');
        document.getElementById(pageId).classList.remove('hidden');
    }

    function closePage(pageId) {
        document.getElementById(pageId).classList.add('hidden');
        document.getElementById('landing-view').classList.remove('hidden');
    }

    function openContact() {
        if (window.HubSpotConversations) {
            window.HubSpotConversations.widget.open();
        } else {
            alert("Chat support is loading. Please try again in a moment.");
        }
    }

    function handleOpenAccount() {
        document.getElementById('account-loading-modal').style.display = 'flex';
        setTimeout(() => {
            document.getElementById('account-loading-modal').style.display = 'none';
            goToLogin();
        }, 1500);
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

    function navTo(pageId, el) {
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        if(el) el.classList.add('active');
        document.querySelectorAll('.section-view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + pageId).classList.add('active');
        
        const titleMap = {
            'home': currentUser || 'User', 'transfer': 'Wire Transfer', 'payments': 'Bill Payments',
            'cards': 'Card Manager', 'stocks': 'Equity Portfolio', 'crypto': 'Digital Assets',
            'settings': 'Security', 'concierge': 'Concierge'
        };
        
        const titleText = titleMap[pageId] || 'Wealth Overview';
        if(pageId === 'home') {
            document.querySelector('.welcome-text').style.display = 'block';
            document.getElementById('page-title').innerText = currentUser || 'User';
        } else {
            document.querySelector('.welcome-text').style.display = 'none';
            document.getElementById('page-title').innerText = titleText;
        }
        document.getElementById('sidebar').classList.remove('active');
    }

    function handleProfileUpload(input) {
        if (input.files && input.files[0] && userData) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('user-avatar-img').src = e.target.result;
                userData.profilePic = e.target.result;
                db.ref('users/' + currentUser + '/profilePic').set(e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function askPin(cb) {
        pendingAction = cb;
        document.getElementById('pin-modal').style.display = 'flex';
        document.getElementById('pin-entry').focus();
    }

    function showReceipt(index) {
        if (!userData || !userData.transactions) return;
        currentReceiptData = userData.transactions[index];
        renderReceiptInModal(currentReceiptData);
        document.getElementById('receipt-modal').style.display = 'flex';
    }

    function renderReceiptInModal(tx) {
        const amountDisplay = Math.abs(tx.amount).toLocaleString('en-US', {style:'currency', currency:'USD'});
        const accDisplay = tx.accNum || 'N/A';
        document.getElementById('receipt-content').innerHTML = `
            <div class="receipt-row"><span>Status</span><span style="color:var(--success)">SUCCESSFUL</span></div>
            <div class="receipt-row"><span>Reference ID</span><span>${tx.ref || 'N/A'}</span></div>
            <div class="receipt-row"><span>Date</span><span>${tx.date}</span></div>
            <div style="border-bottom:1px dashed #ccc; margin: 10px 0;"></div>
            <div class="receipt-row"><span>Beneficiary</span><span>${tx.entity}</span></div>
            <div class="receipt-row"><span>Account No.</span><span>${accDisplay}</span></div>
            <div class="receipt-row"><span>Amount</span><span style="font-size:16px;">${amountDisplay}</span></div>
            <div style="border-bottom:1px dashed #ccc; margin: 10px 0;"></div>
            <div class="receipt-row"><span>Sender</span><span>${currentUser || 'User'}</span></div>
        `;
    }

    function printReceipt() {
        if(!currentReceiptData) return;
        const tx = currentReceiptData;
        const amountDisplay = Math.abs(tx.amount).toLocaleString('en-US', {style:'currency', currency:'USD'});
        const accDisplay = tx.accNum || 'N/A';
        const printWindow = window.open('', '', 'height=600,width=400');
        printWindow.document.write('<html><head><title>Transaction Receipt</title><style>body{font-family:sans-serif; padding: 20px;} .header{text-align:center; margin-bottom:20px;} .row{display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px;} .line{border-bottom:1px dashed #000; margin:15px 0;} .total{font-weight:bold; font-size:18px;}</style></head><body>');
        printWindow.document.write('<div class="header"><h2>Fintrustco</h2><p>Transaction Receipt</p></div><div class="line"></div>');
        printWindow.document.write(`<div class="row"><span>Date:</span><span>${tx.date}</span></div><div class="row"><span>Reference:</span><span>${tx.ref || 'N/A'}</span></div><div class="row"><span>Beneficiary:</span><span>${tx.entity}</span></div><div class="row"><span>Account No:</span><span>${accDisplay}</span></div>`);
        printWindow.document.write('<div class="line"></div><div class="row total"><span>TOTAL PAID:</span><span>'+amountDisplay+'</span></div><div class="line"></div><div style="text-align:center; font-size:12px; margin-top:20px;">Electronically Generated Receipt.<br>Fintrustco Private Banking</div></body></html>');
        printWindow.document.close();
        printWindow.print();
    }

    function openEmailModal() {
        document.getElementById('email-modal').style.display = 'flex';
        document.getElementById('email-loader').classList.add('hidden');
    }

    function sendEmailAction() {
        const email = document.getElementById('statement-email').value;
        if(!email) return alert("Please enter a valid email.");
        document.getElementById('email-loader').classList.remove('hidden');
        setTimeout(() => {
            alert(`Encrypted Statement successfully sent to ${email}`);
            document.getElementById('email-loader').classList.add('hidden');
            closeModal('email-modal');
        }, 2000);
    }

    // Initialize
    restoreSession();
    updateCurrentLangLabel();
</script>

<!-- Hidden div for Google Translate (required for API) -->
<div id="google_translate_element_hidden" style="display:none;"></div>
<!-- Google Translate Script -->
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
